 Chapter 2

% variables
\newcommand{\pdirtwo}{chapters/plots/chapter2}

\chapter{The NA64 experiment} % Main chapter title

\label{chapter2} % For referencing the chapter elsewhere, use \ref{Chapter2} 

% ----------------------------------------------------------------------------------------

The second step of any physics experiment, after a clear goal is set, is the design of the setup to perform the test. As we decided to perform an experiment to probe the $\umodel$, the first thing we need to realize is how to produce such type of dark matter in colliders. A new symmetry theorized is mixed with the well studied symmetry $U(1)$ of the standard model, the channels that allow the production of this new boson $\DM$ are similar to the one that can be used for $\gamma$. The channels that contribute in first order are the following:

\begin{itemize}
\item \textit{Dark Bremsstrahlung}: The reaction $\darkbrem$ where $\DM$ is emitted after a virtual photon is exchanged with a target nucleus.
\item \textit{Dark Compton}: The reaction $\darkcompton$, where $\DM$ is produced as a consequence of the interaction of a photon and an electron.
\item \textit{Dark Resonance}: The reaction $\darkresonance$ where two leptons annihilated and produce a $\DM$ as a consequence of a resonance.
\end{itemize}

The Feynman diagrams of all processes mentioned above are depicted in Fig.\ref{fig:dm-production-mechanism}.

% INSER HERE A PICTURE WITH ALL FEYNMAN DIAGRAM OF THE CORRESPONDING CHANNELS
\begin{figure}
\centering
\includegraphics[width=.45\textwidth]{\pdirtwo/DarkBremstrahlung.png}
\includegraphics[width=.45\textwidth]{\pdirtwo/DarkCompton.png}
\includegraphics[width=.45\textwidth]{\pdirtwo/DarkResonance.png}
\includegraphics[width=.45\textwidth]{\pdirtwo/DarkAresonance.png}
\caption{Possible production mechanism for $\DM$: Dark Bremsstrahlung a), Dark Compton b), resonance production c) and A-resonant production d).}
\label{fig:dm-production-mechanism}
\end{figure}

One has to be careful and consider the list above a simple guideline that is in no way exhaustive. Other channels might be possible with minimal extension of the model, or one could find a significant yield of production not only in the scattering of an electron but also in more exotic physic. An example would be using the electromagnetic portion of a large hadron shower to compute the yield of $\DM$. This was for example claimed to be a useful method to search for low mass $\DM$ in \cite{Celentano:2020vtu}.

A careful reader might object that the particles needed for each production channel are different. Indeed while a nuclei Z is always present in matter, the presence of a $\gamma$ or a $e^+$ might not be as straightforward. We remind here, however, that in an electromagnetic shower originated by a high energetic lepton all three particles will be produced in large quantity due to the subsequent process of pair-production and Bremsstrahlung that are the most relevant for high energetic $\gamma$ and high energetic $\ee$ respectively. A complete review of electromagnetic and hadronic shower can be found here \cite{Bichsel:2002cf} for the interested. Indeed the production mechanism will be more relevant later when the analysis is performed, in normal circumstances when a high energy particle hit a thick target all of the mentioned mechanism will be relevant to some degree. In our case, the Dark Bremsstrahlung $\darkbrem$ is used "Golden Channel" for the production. The reason is that it is relatively easy to compute using analytical formulas in good approximation (see Appendix\ref{appA:sec:cross-section} for more details) and has a very good yield compared to the other channels. This is not to say that the other channel does not matter, but at this stage where the experiment is being designed we will consider them as minor corrections to a production rate mostly dominated by the Dark Bremsstrahlung. To avoid confusion in the reader, we also admit here that an appropriate analysis might make such a contribution very relevant. An example can be found in \cite{Marsicano_2018} where the non-resonant and resonant production are used to improve significantly the signal yield for a specific mass range.

After the production mechanism is chosen, some first estimate on the signal yield can be performed. However successfully producing the particle is not by itself sufficient without a mechanism device to detect it. The question that becomes interesting here is: what happens to $\DM$ after it is produced inside a target? We remind the reader here that since a coupling between standard matter and dark matter was theorized in the $\umodel$ model, the $\DM$ will be able to decay in a $\ee$ pair (or in more massive leptons) provided that its mass is sufficiently large, but it could also decay in particles of the dark sector, the one called $\dmchi$ introduced in Sec.\ref{ch1:sec:dm-u1model}. The exact branching ratio can be calculated to be:

\begin{equation}
\label{ch1:eq:dm-bratio}
\Gamma(A'\rightarrow\dmchi) = \frac{\alpha_D}{3}m_{A'}(1 + \frac{2m^2_{\chi}}{M^2_{A'}})\sqrt{1 - \frac{4m^2_{\chi}}{M^2_{A'}}} 
\Gamma(A'\rightarrow\dmchi) = \frac{\alpha \epsilon^2}{3}m_{A'}(1 + \frac{2m^2_{e}}{M^2_{A'}}\sqrt{1 - \frac{4m^2_{e}}{M^2_{A'}}} 
\end{equation}

To simplify, we consider the two cases where the branching ratio is dominated by one single decay

\begin{itemize}
\item \textbf{Invisible decay:} If $\alpha_D / (\alpha \epsilon^2) \gg 1$ the A' will decay mainly in $\dmchi$. This decay is called invisible, as the decay products interact very weakly with standard matter
\item \textbf{Visible decay:} If $\alpha_D / (\alpha \epsilon^2) \ll 1$ the A' will decay mainly in $\ee$. This decay is called visible, as the decay products can be easily detected since they posses an electromagnetic charge. 
\end{itemize}

As always we need to admit that physics always offers a plethora of possibilities that are not always easy to summarize in a thesis. There is no meaningful constraint that prevents both branching ratios to be on a similar footing. Likewise, models with more complicated decay are possible. An example is the one illustrated in \cite{Mohlabeng_2019}, where the decay chain $\dmsemivis$ dominates. It is of course possible to adjust the setup to be more sensitive to a specific model that turns out to be interesting, but in the interest of time we will focus on the two-channel explained above that outside of being interesting are the main interest of the NA64 experiment.

The technique used in NA64 to detect these two channels will be explored in Sec.\ref{ch2:sec:experimental-technique}. After that, the two setups designed for each of the specific two cases will be described in Sec.\ref{ch2:sec:experimental-setup}. Finally, a detailed description of each detector involved and their purpose will be outlined in Sec.\ref{ch2:sec:detectors}.


\section{Experimental Technique}
\label{ch2:sec:experimental-technique}

The detection of the $\DM$ needs to follow different strategies depending on what decay channel is favored by it. If $\DM$ decays mainly into $\dmchi$, one could try to detect one of the two particles using a very thick detector. Indeed this is possible since by definition in the $\umodel$ a portal exists that connects dark matter to the classical one. However, such an experiment will have a very limited reach, not only a factor $\alpha \epsilon^2$ needs to be "paid" to produced $\DM$ but an additional $\alpha \epsilon^2$ is also needed to detect its decay product. It is clear that especially for low coupling $\epsilon$ the probability to detect a single $\DM$ becomes vanishingly small. The second possibility is to make the disappearance of energy the signal of the experiment, i.e. assuming that the energy of $\DM$ is completely lost in the event. Such an experiment needs only to produce $\DM$ and does not need to worry about what happened to the particle after. To design a setup able to characterize this type of signature properly, we need to worry about the following items:

\begin{itemize}
\item The initial momentum of the particle needs to be well known
\item The setup needs to be completely hermetic, i.e. no energy can escape detection without using the channel 
\item The initial particle ID needs to be well known
\end{itemize}

While the two first item are fairly trivial, one could wonder why the last one is necessary. If we need to apply any kind of statistical analysis to our data one has to know the total number of the electron that impacts our target, the so-called Electron On Target (EOT), so in this sense to understand the sensitivity of the experiment suck knowledge is necessary. On top of this, however, the particle ID is necessary also to distinguish events that are in our signal box even if no $\DM$ is being produced. A precise background discussion is left for Chapter \ref{chapter3}, here we just provide the example of the decay chain $K^- \to e^- \nu_e$ \cite{review-particle-physics}: if a $K^-$ hits the target without being properly distinguished, it can leave an electromagnetic signature and at the same time transport some energy out of the setup via $\nu_e$. This is exactly the signature we would expect for $\DM$! Hence the necessity of some system able to distinguish between particles of different species.

What about the visible mode? If we assume the decay $\aee$ is prominent, it is clear that missing energy can no longer be considered a signature. One should search for a $\ee$ pair in the final state, these particles are however very common in a particle physics experiment, so one has to think how to characterize the event more. The property that mostly characterizes dark matter is its inability to interact with ordinary matter and hence travel freely inside very dense material. Since $\DM$ travels for a finite distance before decaying, if the target is thick enough, the only way to see an $\ee$ emerging from the target will be that a $\DM$ is being produced. A simple $e^-$ will be stopped by the thick target and nothing will emerge on the other side of the wall. If on the other hand, we measure a high-energetic $\ee$ pair emerging on the other side of the wall and the energy of this pair matches exactly the one that is missing from the target, we conclude that the energy was transported outside the volume using a neutral boson. Assuming that no such channel exists in the standard model (which is to be demonstrated with a detailed background study) we can claim the observation of an event compatible with our hypothesis! Noticed in this case as well the three properties listed above are necessary, indeed one needs to know with good precision the initial momentum of the particle hitting the target and be sure that the particle is an electron. In this case, however, the signal is not missing energy but instead, energy conservation between a detector placed upstream and the one placed downstream. This concept is similar to what is used for Axion searches, the so-called "Light Shining Through a Wall" experiments, where the two photons of the Axion decay are detected downstream a very thick wall (for a review, look here \cite{Jaeckel:2010ni}).
If we assume the energy of the primary electron to be $E_0$ and we plot the energy recorded in the two calorimeters, we can conceptualize the difference between the two signature in Fig.\ref{fig:two-signature}. As one can see, we are assuming here that the first calorimeter can stop the incoming particle with 100\% efficiency, and that therefore the only way to reach the downstream calorimeter is via the production of dark matter. Although this is mostly the case if the incoming particle is an $e^-$, to probe the $\umodel$ one has to collect a huge number of EOT, in the order of $10^{12}$, it is clear that one a statistic so high is collected even event with a very small chance to happen need to be properly studied. A good setup should not only implement the fundamentals described above but also suppress as much as possible all the background that can potentially leak in the signal box.

\begin{figure}[bth!]
\centering
\caption[two signature sketch]{Sketch of the two possible signature in a collider setup to probe the $\DM$ existence.}
\label{fig:two-signature}
\end{figure}

\subsection{invisible decay mode}
\label{ch2:sec:experimental-technique-invis}

\subsection{visible decay mode}
\label{ch2:sec:experimental-technique-vis}

\section{Experimental setup}
\label{ch2:sec:experimental-setup}

In collider experiments, the first choice of a facility to provide the initial beam for the experiment can be crucial. A good initial beam with a low fraction of impurities and good momentum definition can dramatically change the background condition. The NA64 experiment uses the upgraded H4 electron beamline at CERN SPS. The beam is produced by the primary proton beam of 450 \si{\giga\electronvolt} with an intensity up to 10$^{12}$ Proton On Target (POT) per SPS spill. The electrons are produced on a primary beryllium target and transported to the detector inside the evacuated beam-line tuned to an adjustable beam momentum. A precise description of the beam apparatus can be found here \cite{sps-beamline,h4-beamline}. The beam properties can be tuned for the precise experiment, hence its precise property can depend on the target used for the conversion, the magnetic field employed, and other components. In the case of NA64, two different compositions are used depending on which $\DM$ decay is being probed. In the case of the invisible decay $\ainv$, the beam momentum is tuned to 100 \si{\giga\electronvolt}. In this condition, a purity $\pi^-/e^- \lesssim 10^{-2}$ is achieved with a beam size of $\sim$1.5\si{cm} (FWHM). In the case of the visible decay $\aee$ on the other hand, large initial energy can be helpful to boost the decay time of the $\DM$ outside the target and therefore increase the sensitivity of the setup. This is especially true for the $\DMX$, since an important portion of the parameter space justifying this anomaly is characterized by large coupling $\epsilon \gtrsim 10^{-3}$ and hence a decay time $\tau \lesssim 10^{-13}$\si{s}. In this case, the beam is tuned to 150 \si{\giga\electronvolt} as a compromise between high-energy and small beam degradation.

In the next sections, both of the setup used by NA64 will be described in detail. Since the physics happening is the same before the electron hits the target, the two setup shares many similarities. We will follow here a historical approach where we will describe first the invisible mode setup which was first used in the test beam of 2016. In Sec.\ref{ch2:sec:vismode} on the other hand we will focus on the most important difference between the two setups.

\subsection{The invisible mode setup}
\label{ch2:sec:invismode}

The NA64 invisible mode setup has changed slightly during the year as the understanding of the specific problems in the $\DM$ search was discovered. In the interest of time, we will here describe 

After the 100 \gev e$^-$ enter the setup, its momentum needs to be measured precisely to provide an initial estimate of its energy. This is achieved using a magnetic spectrometer using an integrated field of $\sim 7 T \dot m$ achieved using two dipole magnets \cite{mbpl} placed in series along the primary axis of the beam. The entrance angle of the particle inside the magnet is defined by two Micromegas (MM) trackers placed inside the 5 m space between the beam inlet and the first magnet entrance. Between the two MM, in a space of approximately 2 m, two scintillators ($S_{0-1}$) and a V counter are placed to ensure a proper beam definition. The V counter consists of a scintillator with a hole in the middle and is used to reject particle with a high beam divergence that could in principle be a source of background. After the two magnets, a vacuum tube kept at the pressure of approximately 10$^{-3}$ \si{mbar} is placed immediately after for a total length of 10.2 \si{m}. The vacuum tube minimize the interaction of the particles during its travel to the target, this is important to reduce the energy loss of the primary e$^-$ before its energy is measured again in the ECAL, but as will be detailed in Sec.\ref{ch3:sec:bkg-srd} reducing the ionization increases the background suppression achievable with synchrotron radiation. After the vacuum tube, additional space of $\sim$ 4.5 \si{m} contains the last detector before the target. The second set of three scintillators ($S_{2-3-4}$) complete the triggers. Three sets of Pb-Sc sandwiches are placed in the arch contained between the original beam and the bent beam direction to collect the synchrotron radiation emitted in the magnetic field upstream. On the other side of the beam, another similar detector with no transversal segmentation (W sandwich) is placed to reject events with high beam divergence or where the electron experienced an high energy scattering upstream. Four more MM are placed along the beam to complete the momentum reconstruction by detection of the precise hit position of the electron after its passage through the magnetic field. Eight more tracking detectors are placed before the ECAL: 2 Strawtubes (St), 2 Hodoscope (H), and 4 four Gas Electron Multiplier (GEM). The GEM detectors have a similar hit resolution and efficiency similar to the MM, with the advantage of not being multiplexed, hence they experience less redundancy in the hit position at the cost of a larger number of channels. As it will be detailed in Sec.\ref{ch2:sec:detectors-tracking} the multiplexing does not limit the momentum resolution and hence the final performance given are comparable overall. The strawtubes and Hodoscope on the other hand posses a larger active area ($\sim$0.5 m), but a hit resolution of $\sim$1\% which makes them less suitable to reconstruct the momentum precisely (insert here straw reference?). This detector have however the virtue of being large enough to detect charged particle emitted at a large angle, and hence can reject some rare events that are produced by inelastic scattering of the incoming particles on one of the MM modules placed downstream. These events although rare, cannot be caught by the W and they can be a source of background for the large number of EOT required by the experiment \cite{na64-prd}. 

After this region is passed, the primary electron finally hit the active target (ECAL). Here the energy of the electron is measured again by stopping the particle completely. The ECAL is made of 36 modules arranged in a 6$\times$6 matrix, each module has a Pb-Sc structure with 150 layers for a total of 40$X_0$. Due to its transverse segmentation, the ECAL allows further background rejection using a shower profile analysis to distinguish between an em-shower and a hadronic one. To ensure complete hermeticity, a high-efficiency VETO and a large Hadronic CALorimeter (HCAL) are placed after the ECAL target. The VETO consist of three separate scintillators stacked together for a total thickness of 5\si{cm} and reject MIP with an estimated efficiency of 99.9$\pm$0.1\%. The HCAL placed immediately after consist of four modules of $\simeq$7 $\lambda_{int}$ (nuclear interaction length) each. Each module is built in a 3$\times$x matrix of a single Fe-Sc sandwich array. The role of this last calorimeter is to block all possible particles penetrating the ECAL and grants complete energy hermeticity to the setup. In the past version of the setup, all four modules were stacked in series after the ECAL to grant a total of $\simeq$28 $\lambda_{int}$. In the more recent version of the setup from Fig.\ref{fig:setup-invis-2018} however, the last module is shifted to face the original beam axis. After the first test beam, it was clear that the additional background suppression of a fourth module was not needed. Instead, the last module is used to gain insight into the neutrals in the beam and can catch large bremsstrahlung photons emitted before the magnet by the incoming electrons. A more detailed description of all this detector can be found in \ref{ch2:sec:detectors}.


\begin{figure}[tbh!]
\centering
\includegraphics[scale=0.8]{\pdirtwo/setup-invis-2018.pdf}
\caption[invisible mode setup 2018]{Invisible mode setup 2018, top view.}
\label{fig:setup-invis-2018}
\end{figure}

\subsection{The visible mode setup}
\label{ch2:sec:vismode}

The visible mode setup is obtained by modifying slightly the invisible mode setup to accommodate the $\aee$ decay in a long decay volume where the $\ee$ pair is measured by a scintillator counter and four GEM station (Fig.\ref{fig:setup-vis-2018}). The energy of the beam is increased to 150 GeV. The reason for this is to boost the decay time of the $\DMX$ to increase its probability to leave the dump. As a consequence, the total displacement in the X-direction of the primary beam is roughly $\sim$10 \si{mm} smaller. Since the space between the origin and bent beam axis is reduced, only two modules of the SRD detector can be placed in this space, which decreases the suppression of heavy charged particles. Additionally, the smaller bending has an impact on the momentum reconstruction as well, this however is not very significant for this analysis. Since no energy evaporates in this mode, there is no direct need to compare two different energy measurements. Instead, another compact calorimeter made of a Tungsten-scintillator sandwich (WCAL) is placed in front of the ECAL and acts as the target in this new setup. This calorimeter has a total of 30$X_0$ in a compact length of $\sim$20 \si{cm}. The $\DM$ is produced via scattering off nuclei in this active dump, followed by its decay $\aee$ after traveling for some distance without interaction. To ensure that the decay happens after the dump, the last two layers of the WCAL read separately (W2), and act as a VETO to stop high energetic particles that leak from the em-shower to enter the decay volume undetected. A vacuum tube of 3.1 \si{m} kept at a pressure of $\sim$10$^{-2}$ \si{mbar} is placed immediately after the dump to minimize interaction of the $\ee$ after the decay. A scintillator (S$_4$), is placed immediately after the tube to detect the presence of the $\ee$ pair with a double-MIP signal inside this counter. A set of four GEM detectors are then placed in the last $\simeq$2.5 \si{m} of air before the second active target (ECAL). In principle, these four trackers can reconstruct the angle and the vertex of the decay to offer an additional characterization of the signal. These tools were not used in the analysis performed in 2018 \cite{Banerjee:2019hmi}, but in this work, an analysis considering the trackers as well is described in detail (see Sec.\ref{ch3:sec:vis-mode-tracking}). Finally, the ECAL detect the remaining energy of the two $\ee$ pair in the decay volume, and matches it to the one measured in the WCAL. If the sum $E_{WCAL}+E_{ECAL}$ is compatible with the initial primary energy E$_0$, we conclude that some energy escaped the first dump WCAL using a channel not compatible with the standard model of particles. At the tail of the setup, a high-efficiency VETO and the HCAL are still presented to guarantee again the hermeticity of the setup similar to the invisible mode. One could question the usefulness of these detectors in this mode. Indeed if we can guarantee that only 150 GeV $e^-$ are in the system, the simple requirement of energy conservation should be enough to reject all backgrounds coming from impurities in the beam. Again here we need to remember that the many assumptions made in theory can encounter many problems in practice. The pileup of two different events, one hadronic and one electromagnetic could easily break this assumption. The limited energy resolution of the two calorimeters can likewise produce on the rare occasion a wrong measurement that implies energy conservation in an event. On top of this, the HCAL is invaluable to properly estimate the hadron contamination of the beam (and therefore the precise number of EOTs accumulated) and to select the rare event $\emu$ where two muons are produced in the dump inside the em-shower. As we will see this type of event is crucial for our analysis to properly account for the systematic of the experiment, both in the invisible and visible mode, which makes the HCAL and VETO necessary for both setups.

\iffalse
The method of the search for $\aee$ (or $\xdecay$) decays is detailed in . Here, we review it briefly. The $\DM$ is produced via scattering of 150 GeV electrons off nuclei of an active target-dump. The $\DM$ production is followed by its decay into $\ee$ pairs:
detailed in \cite{Gninenko:2013rka, Andreas:2013lya, gkkk1, DMsimulation}, 
\begin{equation}
e^- + Z \to e^- + Z + \DM ;~ \DM\to \ee \,.
\label{ea}
\end{equation}
\fi

\begin{figure}[tb]
\centering
\includegraphics[width=1.\textwidth]{\pdirtwo/NA64_setup_2018_visible.pdf}
\caption[NA64 visible mode setup 2018]{The setup to search for $\DM$$\to \ee$ decays of the bremsstrahlung $\DM$ produced in the reaction
$eZ \to eZ+\DM $ of the 150 GeV electrons incident on the active WCAL target.}
\label{fig:setup-vis-2018}
\end{figure}

\section{Detectors}
\label{ch2:sec:detectors}

In this section, the various detectors that are used to build the two setups described above are described in more detail to give a technical overview of each component of the setup. More information about each detectors are detailed in \cite{na64-hcal,na64-detectors,ABBON201569}. 

\subsection{The Trigger system}
\label{ch2:sec:detectors-trigger}

The trigger system is based on the coincidence and anti-coincidence of different scintillator counters placed along with the beam directions and the requirement of specific energy in the primary active dump (the ECAL in the invisible mode and the WCAL in the visible mode).

Five plastic scintillators (S$_{0-4}$) and one Veto (V) are used in the NA64. They have a variable diameter ranging from 32 to 42 \si{mm} and a thickness of 3-5 \si{mm}. The sandwich S$_0$-V-S$_1$ is placed in front of the beam inlet to characterize the initial particle direction. To pass this first step of the trigger, a particle need to leave a signal of $\sim$0.8 MIP in S$_{0-1}$ and no signal in V, i.e. following the condition:

\begin{equation}
\label{eq:trigger-upstream}
Tr_U = S_0 \cdot \bar{V} \cdot S_1
\end{equation}

The signal needs to be in a coincidence compatible with the time resolution of the two scintillators ($\simeq$3 \si{ns}) to suppress the pileup. Downstream, three more scintillators are placed (S$_{2-4}$) in the case of the invisible mode (See Fig.\ref{fig:setup-invis-2018}) and a coincidence of all three is also required as a part of the trigger downstream. In the case of the invisible mode, only the first of three scintillators (S$_2$) is part of the trigger, S$_3$ is removed and S$_4$ is placed after the decay for analysis purpose without being a direct part of the trigger. This means:

\begin{equation}
\label{eq:trigger-downstream}
Tr^{invis}_D = S_2 \cdot S_3 \cdot S_4
Tr^{vis}_D = S_2
Tr_{U+D} = Tr_U \cdot Tr^{invis/vis}_D
\end{equation}

In this case, we notice that the scintillator S$_2$ downstream is small enough to already limit significantly the range of momenta accepted in the trigger of the experiment ($\gtrapprox$ 90 \si{\gev})). However large beam divergency coupled to trigger pileup can still potentially accepted a low energy $e^-$ inside the setup, hence the necessity of a tracking system. As a final tool for the beam definition, a small energy deposit in W is required, to reject the event with large upstream bremsstrahlung. The exact threshold is not consistent between different runs, but it is always in the range of 3-6 \si{\gev}. We define the beam-trigger as the sum of all these components in the two different setups:

\begin{equation}
\label{eq:trigger-beam}
Tr_{beam} = Tr_{U+D} \cdot \bar{W}
\end{equation}

Finally, as the DAQ can collect data at a rate of $\simeq$10 \si{kHz}, one need an additional condition to select only those events that have a chance to be in the signal region. In both setup, this means some missing energy in the primary target-dump. Additionally, since both WCAL and ECAL have some longitudinal segmentation, one can use the pre-shower information to suppress the hadron background at trigger level. This is achieved by splitting the signal in these modules to feed them to a discriminator. The trigger in this case has the following form:

\begin{equation}
\label{eq:trigger-phys}
\begin{split}
& Tr^{invis}_{phys} = ECAL^{presh}(>300 MeV) \cdot ECAL(<85 GeV)\\
& Tr^{vis}_{phys} = WCAL^{presh}(>500 MeV) \cdot WCAL(<110 GeV)
\end{split}
\end{equation}

The final trigger during data taking will be a combination of both the primary trigger for the beam definition and the physical trigger used to obtained a rate that can be handled by the DAQ. We obtain finally:

\begin{equation}
\label{eq:trigger-total}
\begin{split}
& Tr^{invis}_{total} = S_0 \cdot \bar{V} \cdot S_1 \cdot S_2 \cdot S_3 \cdot S_4 \cdot \bar{W} \cdot ECAL^{presh}(>300 MeV) \cdot ECAL(<85 GeV)\\
& Tr^{vis}_{total} = S_0 \cdot \bar{V} \cdot S_1 \cdot S_2\cdot \bar{W} \cdot WCAL^{presh}(>500 MeV) \cdot WCAL(<110 GeV)
\end{split}
\end{equation}

The precise definition of the trigger varies between different runs. In general, we can define three different runs:

\begin{itemize}
\item \textbf{Hadron calibration run:} Where $\pi^-$ is used as primary particle and only $Tr_{beam}$ is used. These runs are used to measure precisely the interaction of such heavy charged particles in the setup to study precisely the background suppression in NA64. Their intensity is suppressed due to the thick target placed inside the beamline ($\lesssim 10^{-3}$ $\pi^-$\si{\per\second}).
\item \textbf{Electron calibration run:} Where $e^-$ is used as primary particle and only $Tr_{beam}$ is used. These runs are used to measure the typical interaction of an EOT without a physical trigger that biases the final distribution. 
\item \textbf{Physical run:} Where $e^-$ is used as primary particle and both $Tr_{beam}$ and $Tr_{phys}$ are used. This runs contain all the data used for the final analysis. 
\end{itemize}

We remind here that although the Physical runs use an electron beam, the physical trigger used naturally selects events with hadrons as a primary particle. This is obvious from the fact that the vast majority of $e^-$ will deposit all their energy inside the target-dump, hence will be rejected by the physical trigger. This means that the sample of events recorded will have a large percentage of hadrons that will be rejected by the selection criteria. To properly account for the cuts efficiency, electron and hadron calibration runs are used, since the impurity of the sample is well known and easy to remove. The most classical approach to remove the impurity is an SRD cut: electrons can be selected or rejected by measuring the presence or absence of the synchrotron radiation in the SRD crystals. This improves the purity from a $\lesssim 1\%$ to $\lesssim 10^{3}\%$, therefore, permitting precise studies on the various cuts. 

\subsection{The Electromagnetic Calorimeter (ECAL)}
\label{ch2:sec:detectors-ecal}

The electromagnetic calorimeter shown in Fig.\ref{fig:ecal-sketch} is a shashlik type detector design for energy measurement, shower profile measurement, and $e/\pi$ separation. Its design consist in a 6$\times$6 matrix of single modules with dimension 38.2$\times$38.2$\times$471 \mmc. Each cell consists of 150 layers, which in turn are made of 1.5 \mmi as converter layer, 0.14 \mmi of paper as the separator, and 1.5 \mmi for energy measurement. This is equivalent to 40$X_0$ radiation length. The single cell is further divided into two different longitudinal segments. The first one is called pre-shower and consists of 16 layers ($\sim$4.27$X_0$) and gives resolution to the very beginning of the shower. Since $e^-$ and $\gamma$ trigger an em-shower very early (with the $\gamma$ being a bit delayed within respect to the electron. see \cite{Bichsel:2002cf}), this information can be used to discriminate such particles from all the ones with higher penetrating power (mostly $\pi^-$ and $\mu^-$ in the NA64 case). The second part called simply main ECAL consist of the remainder of the 134 layers ($\sim$35.73$X_0$), and its purpose is to completely stop the incoming particle to measure its energy. The light collection of the scintillator part is performed by WLS fibers BCF91a \cite{wls-fibers} inserted in a spiral along with the cell to avoid energy leak through them. The Calorimeter is calibrated using a low-intensity electron beam where a mechanical support structure is used to move every single cell on the beam center. The pre-shower and the main calorimeter are then calibrated using a Gaussian fit and the precise energy fraction between the two longitudinal segments is calculated through a detailed MC simulation. The energy resolution estimated for this detector is of $10\% / \sqrt{E[GeV]}$.

\begin{figure}[bth!]
\centering
\includegraphics[scale=1]{\pdirtwo/ECAL.pdf}
\caption[ECAL sketch]{Technical sketch of the Shaslik type calorimeter.}
\label{fig:ecal-sketch}
\end{figure}

\subsection{The Hadronic Calorimeter (HCAL)}
\label{ch2:sec:detectors-hcal}

The hadronic calorimeter in the NA64 experiment consist of four modules and its primary purpose is to stop and reconstruct the energy of a high penetrating particle. This includes the $\pi^-$ and $K^-$ contained as impurities in the beam but also neutrons and protons that can be produced in inelastic scattering in the ECAL. Additionally, although a complete stop of 100 GeV $\mu^-$ remains unfeasible, the HCAL can characterize very efficiently the presence of such particle after the ECAL, as the $\mu^-$ will leave the very distinctive MIP energy deposit inside each module, amounting roughly to $\sim 2.5$ \gev. Each module of the HCAL is a 3$\times$3 matrix of cells. Each cell is a sandwich of alternating layers of 25 \mmi Iron (Fe) and 4 \mmi of scintillating material separated by a 9 \mmi gap of air. Each cell consists of 48 such layers for a total thickness of $\simeq 7\lambda_{int}$. The lateral size of each module is 194$\times$192 \mms. The light readout is analogous to the one of the ECAL, using WLS-fibers embedded in round grooves in the scintillator plates. The fibers from each cell are collected together in a single optical connector at the side of the module. Each of the 9 optical connectors is then read-out by a single photomultiplier. Similar to the ECAL, these modules are calibrated using special runs where 50 \gev $\pi^-$ are shoot at different cells with the help of a mechanical table. The energy resolution estimated for this detector is $\sim 50\%/\sqrt{E[GeV]}$

\begin{figure}[bth!]
\centering
\includegraphics[scale=1]{\pdirtwo/HCAL.pdf}
\caption[HCAL sketch]{Technical sketch of the HCAL module used in the NA64 experiment.}
\label{fig:hcal-sketch}
\end{figure}

\subsection{The Synchrotron radiation detector (SRD)}
\label{ch2:sec:detectors-srd}

The Synchrotron radiation detector (SRD) is a small calorimeter placed downstream in the arc described by the original beam axis and the bent beam. Its purpose is to measure the energy of the photon emitted by the passage of each electron in the magnetic field downstream. The energy range of such a signal is in the order of a few tens of MeV, hence the need for a larger precision compared to the calorimeter used to measure the primary beam. The detail of heavily charged particle suppression will be described more in detail in Sec.\ref{ch3:sec:bkg-srd}, here we described the detector technically.

Historically, the first Synchrotron radiation detector used was a set of 8 BGO crystals arranged in a 2$\times$4 matrices placed parallel to the beam direction. Each crystal has a hexagonal shape with a diameter of 61 \mmi and a length of 200 \mmi. The light readout consists of an EMI PMT 9603 mount on the bottom of each crystal with optical grease. The BGO are excellent candidates for the SRD, due to the high light-yield and radiation length which coupled to their high Z makes them excellent gamma-absorbers \cite{bgo-crystal}. Indeed their rejection power can be as large as $10^{-4}$ and was demonstrated experimentally thanks in the NA64 experiment (see Sec.\ref{ch3:sec:bkg-srd} for details). However, their large decay time of $\sim$300 \si{ns} creates a level of pileup that limit significantly their usefulness in a context where the intensity of the beam is very high.

The BGO detector was substituted with a shashlik type detector since the 2017 beam time. It is a shashlik type detector that uses three adjacent cells of dimension 60$\times$80 \mmi. Each cell consists of 100 layers with a lead-scintillator structure with dimensions 0.1 \mmi and 1.1 \mmi respectively. The light is read out by an R9420-100-10 Hamamatsu PMT with extended green spectral sensitivity \cite{hamamatsu-R9420-100-10}.

The time resolution for the shashlik type SRD is of $\sim$5 \si{ns}, which grants a suppressed pileup even at the largest intensity allowed in the H4 beamline.

\begin{figure}[bth!]
\centering
\includegraphics[scale=1]{\pdirtwo/HCAL.pdf}
\caption[BGO sketch]{Technical sketch of a single BGO crystal.}
\label{fig:bgo-sketch}
\end{figure}

\begin{figure}[bth!]
\centering
\includegraphics[scale=1]{\pdirtwo/HCAL.pdf}
\caption[SRD sketch]{Technical sketch of a single shashlik type module used in the NA64 experiment as SRD.}
\label{fig:srd-sketch}
\end{figure}

\subsection{The Veto system}
\label{ch2:sec:detectors-veto}

The Veto system is the set of detectors that has the purpose of measuring any particle penetrating one of the NA64 calorimeters to catch event with a long longitudinal shower profile that poses a risk to the hermeticity of the setup.

In general, the veto are scintillator-counters of variable dimensions that are placed at the end of one of the calorimeter. The most relevant detector of this type is the VETO, a set of three scintillators mounted in series for a total dimension of 550$\times$550$\times$50 \mmc. The MIP inefficiency of this detector is $\sim 10^{-3}$.

For the visible mode, it is crucial to maintain the dump as short as possible to increase the probability of the $\aee$ decay to be outside of the dump. For this purpose, the last layers of the WCAL sandwich are decoupled from the main readout and used as a veto (called W2). The dimensions of this counter are hence connected to the one of the WCAL: 23$\times$23$\times$6 \mmc. For testing purpose, a second thicker counter (called V2) is still placed at a distance of $\sim3$ \si{cm} from W2 to cross-check its inefficiency. Such a number is then used to compute correctly the signal yield of each run.

In general, a signal event in both visible and invisible mode need is characterized by the absence of energy in the veto counter placed behind that target dump. In practice, we select events with an energy deposit $<$0.8 MIP to take into account both pedestal and energy resolution of these detectors.

\subsection{The Tracking system}
\label{ch2:sec:detectors-tracking}

The tracking system is the set of detectors that allows the full momentum reconstruction and track propagation in the NA64 setup. In the NA64 setup, four types of detectors are capable to reconstruct hits position: Micromegas (MM), Gas Electron Multiplier (GEM), Hodoscopes (H$_i$), and Strawtubes (St$_i$). While all of these detectors were useful for many different studies performed to analyze the beam composition and estimate the background, to this date only MM trackers are used as a direct part of the tracking system. This is to improve the overall efficiency of the selection criteria used for the momentum reconstruction and to limit the systematic of the experiment. In this thesis, however, a new analysis of the visible mode data is proposed that uses data from the GEM trackers to reconstruct the vertex position and the angles of the particles in the decay volume. This analysis is detailed in Sec.\ref{ch3:sec:vis-mode-tracking}.

The exact working principle of each of these detectors is beyond the scope of this thesis. This section will be dedicated mostly to the description of the Micromegas detector, which was a direct part of every analysis currently performed and one of my main responsibilities during the whole thesis. For the interested reader, I recommend the thesis of Peter Degen \cite{pdegen-thesis} which I had the pleasure to supervise. In his work, he gives a very good overview of the working principle of the straw chamber and compares our modules to the MC prediction in the NA64 experiment.

\subsubsection{Micromegas}

Micromegas trackers are a set of eight Multiplexed XY Resistive Micromegas detectors (MM1-MM8) used to reconstruct the 2D hit position of the incoming particles in the NA64 experiment. The design and original testing of the first modules were already the topics of a previous thesis authored by Dipanwita Banerjee, her thesis in an excellent review of their working principle and characteristic \cite{dbanerjee-thesis}. For completeness, here we give a brief review of the detector. As shown in Fig.\ref{fig:mm-sketch}, the primary particle enters the gas box where it ionizes some secondary electrons. In NA64, the gas is a mixture of Argon (93\%) and C02(7\%). While Argon as noble gas is excellent to trigger the ionization the C02 acts as a quencher to absorb UV-light emitted by the argon to avoid an excessive ionization that would both decrease the hit resolution and saturate the detector in many events. The secondary electrons are then guided by the drift field in the amplification gap. The amplification gap is separated from the drift gap with a mesh formed by 400 wires with an aperture size of $\sim$45 \mum, wire diameter $\sim$18 \mum and thickness of the mesh of $\sim$ 29 \mum. The secondary electrons reaching the amplification gap experience a very high electric field of $\sim$ 50 \si{\kilo\volt\per\centi\metre} which triggers a secondary avalanche which multiplies the electric charge that will be collected with the strips in the PCB. While the choice of the amplification field is typically set by the breakdown voltage of the gas, the choice of the drift voltage is more difficult as it can impact the transparency of the mesh. As pointed out in \cite{Bortfeldt:2014vvt}, an electric field of 0.6 \si{\kilo\volt\per\centi\metre} is a good rule of thumb to maximize the efficiency in such gas detector. Another problem for MM comes from the very thin amplification region that makes them particularly vulnerable to sparks, which happens when the total number of electrons in the avalanche reaches the value of a few $sim 10^7$, called Raether limit \cite{BAY2002162,BRESSAN1999321,Raether:102989}. Additionally, to damage the detector and the readout electronics, a spark can also lead to the dead time of the detector and therefore to a significant reduction of its efficiency. The introduction of resistive strips, which add a continuous RC circuit on the top of the readout strip plane, leads to the spreading of charge and consequentially will counter spark development and the drop of voltage. These strips are grounded and separated from the readout strips via a thin insulating layer. The charge is therefore not directly collected by the cooper strips. Instead, an electrical signal is generated via capacitive coupling between the resistive and readout strips.

\begin{figure}[bth!]
\centering
\caption[Micromegas sketch]{Sketch of the micromegas detector used in the NA64 experiment}
\label{fig:mm-sketch}
\end{figure}

In the NA64 case, a negative voltage of 300-360 \si{\volt} (depending on the variable drift height) is applied to the drift plate. The mesh is connected to the ground while the resistive strips are kept at a positive voltage ranging from 560 and 565 \si{\volt} (due to some minor differences between MM). The resistive strips (R-strips) have a resistance of \si{\mega\ohm} and are placed parallel to the X-strips. The Y-strips are placed after the R-strips and perpendicular to them. All set of strips have a pitch of 250 \mum, the width on the other hand is 200 \mum for the R and X strips and 50 \mum for the Y-strips.
Another important feature of this module is the genetic multiplexing of the strips: the strips of the micromegas detector are grouped in a set of five strips connected to a single channel. The results of this scheme are the reduction of the total number of channels needed for a complete readout of a module, indeed the 640 strips of each micromegas (320 strips per plane) can be read by a single APV25 readout chip (see Sec.\ref{ch2:sec:daq}). The trivial consequence of multiplexing is a possible redundancy of the hit position of the incoming particle, which becomes more prominent as the occupancy of single events increases. To minimize this effect, one has to choose the mapping of this strip to maximize the separation between strips connected to the same channel, to make sure that no redundancy takes place. This technique was originally proposed by Sebastien Procureur \cite{Procureur:2013yea}, and consist in distinguishing the original physical channel from the one created as an artifact by the multiplexing mapping by selecting as candidate clusters only the one where several (starting from a minimum of two) neighboring strips shows a signal over the decided threshold. An example of a single electron passing through a plane with different degrees of multiplexing can be seen in \ref{fig:multiplexing-example}. Producing the optimal mapping for the multiplexing where the redundancy is minimal is not a trivial task. Following the recipe in \cite{Procureur:2013yea} one can produce an optimal mapping if the number of channels to map is a primary number. If we consider a detector with $n$ strips that are to be read by a number $p$ of channels, we construct $(p-1)/2$ sublists containing the channel numbers $p$ according to the formula:

\begin{equation}
\label{eq:mm-multiplexing-mapping}
1 + [(i \times s) mod p]
\end{equation}

where $s$ is the number of the sublists and $i$ is ranging from 0 to $p-1$. To complete the list, the channel can be used one more time in the end. In a more general case, Eq.\ref{eq:mm-multiplexing-mapping} can be used when the number of channels is not a prime number. In the NA64 case for example, where per plane we have a multiplexing factor of 5, and $n=320$, $p=64$ the sublists are still constructed following Eq.\ref{eq:mm-multiplexing-mapping}, but instead of using the number $s$ of the sublists a set of $(p-1)/2$ number $s_i$ is calculated to minimize the distance between neighboring strips mapped to the same channel $p$. The set $s_i$ is typically produced using MC-simulations. The map used for both planes of the 8 MM used in NA64 is presented in \ref{tab:mm-map-original}. A new improved map is being prepared for the next generation of the NA64 experiment as presented in Chapter \ref{ch4}.

\begin{figure}[bth!]
\centering
\caption[example of the readout of a multiplexing detector]{prova}
\label{fig:multiplexing-example}
\end{figure}

The multiplexing feature used in NA64 is the first one being used successfully in an experiment with such high intensity. The results however show that these trackers are capable of resisting the high intensity of the beam and allow a precise momentum reconstruction with a precision of $\simeq$1\% at 100 \si{\gev} \cite{Banerjee:2017mdu}.

The total material budget for the two Micromegas, listed in Tab.\ref{tab:mm-mbudget} shows the amount of the material in the way of the beam. 

\begin{table}[bth!]
\centering
\begin{tabular}{|l|c|c|}
&&
\end{tabular}
\caption[material budget MM]{Detail material budget for the the Micromegas used in NA64.}
\label{tab:mm-mbudget}
\end{table}

\subsubsection{GEM detectors}
\label{ch2:sec:gem}
The Gas Electron Multiplier (GEM) is a gaseous tracking detector based on a similar principle of the Micromegas. Their performance is similar for both hit resolution, radiation hardness, material budget, and total active area. The working principle is described in detail in \cite{gem,SAULI20162,ABBON2007455}. Here, we review it. GEM consists of a composite grid of two metal layers separated by a thin insulator (typically Kapton) etched with a regular matrix of open channels. The two metal layers on the opposite side of the grid are kept at a suitable potential difference to create a large field in the hole. Secondary electrons are created by the primary during its passage in the gas and are amplified by the electric field during their drift through the holes. Electrons produced in this multiplication region are then collected by electrodes to measure the impact position of the original particle. To increase the signal GEM can stack multiple plates in series to increase the charge multiplication.

In NA64, the GEMs are produced stacking three consecutive foil to amplify the original signal of the secondary electrons. This allows the detector to reduce the voltage difference between foils to a minimum to ensure a low amount of discharge and allow them to operate efficiently ($\sim$99\% MIP efficiency) in the high intensity of the H4 beamline. The foil has an area of 100$\times$100 \mms with a hole pitch of 140 \mum. The readout consists of a two-layer strip anode with 256 strips per plane and a pitch of 400 \mum. Like the MM, the signal from each strip is processed by 128 channels APV chips, for a total of 4 chips to read out all strips for both XY plane.
One of the main differences between the two types of detectors is that GEM trackers are not multiplexed, meaning that every single strip is readout by a single electronic channel. For the momentum reconstruction, where only one primary particle hits the tracker in a single event, both MM and GEM detector performs similarly due to the clever multiplex map. When more then one particle hits the trackers, a multiplexed detector can create some redundancy that can potentially limit the efficiency and bias the exact hit position, for this reason, GEM detector was placed inside the decay volume during the 2018 visible mode run to maximize the efficiency for signal events, where a $\ee$ is present inside the decay volume.

\subsection{The data Acquisition system (DAQ)}
\label{ch2:sec:daq}

The DAQ used for NA64 is a downscaled version of the COMPASS DAQ system \cite{Bodlak_2013,COMPASS-daq}. The detector's frontends are connected to the readout modules that with a processing speed up to 160 MB/s organize the digital information received by the frontends electronic into a preliminary event-like structure (sub-event building) (see Fig.\ref{fig:daq}. Triggers and control information are passed to these modules via the Trigger Control System (TCS), which work synchronously with the SPS duty cycle and creates the header and distributes the header containing the spill number, event number, and trigger type later used by the event builder PC. Two types of readout modules are used in NA64: the CATCH (Compass Accumulate Transfer and Cache Hardware), a general readout module that supports a wide range of frontend electronics, and the GeSiCa (Gem Silicon Control and Acquisition), which is optimized for the readout of the APV25 frontend chip that is used by both Micromegas and GEM detectors.

The APV25 is an ASIC that combines analog signals with a digital control \cite{Bodlak_2013} originally developed for the readout of the CMS silicon trackers \cite{article,inproceedings,apv-useguide}. Each of the 128 channels of the chip are made by a 60 \nas CR-CR shaping amplifier and a 192 samples deep analog pipelines. The amplifier integrates the current pulse from the input and output of a well-defined voltage pulse. A 192 samples deep analog pipeline is used to store the amplifier output to wait for the external trigger decision. This pipeline is made of switched-capacitor elements. 160 of the 192 memory cells are organized in a ring buffer with a write and trigger pointer. The distance between the two defines the trigger latency which is a configurable parameter. When one of the pipeline columns is flagged for readout, it is copied into one of the remaining 32 memory elements, organized like a FIFO \footnote{\textbf{F}irst \textbf{I}n \textbf{F}irst \textbf{O}ut is a form of data buffer that conserves the order of the incoming data.}. The data are stored here until are sent out by the multiplexer. From here, the data is sent to an ADC\footnote{\textbf{A}nalog to \textbf{Digital} \textbf{C}onverter} modules (which can accommodate up to 4 APV chip) that digitizes the pulse before sending it to the GeSiCa. The ADC has two possible modes of operation, the latch-all mode, and the sparse mode. When using the latch-all mode, the signal amplitudes of all channels is sampled three times with a clock cycle of 25 \nas and transmitted to the GeSiCa. In this mode the trigger rate cannot be higher than $\sim$1 \si{\kilo\hertz} due to the large amount of data received by the APV25. To reach higher trigger rates, the sparse mode is used instead. When in sparse mode, only channels with amplitudes above a certain threshold are sent to the GeSica by the ADC module. This allows us to increase the manageable trigger rate to $\sim$10 \si{\kilo\hertz}. In NA64, the latch-all mode is used to record the data coming by the APV25 connected to the trackers but in absence of the beam. This procedure is repeated every $\sim$10-15 run approximately to record the pedestal of each channel. The pedestal recorded are then used to set the threshold (2$\sigma$ for MM and 3$\sigma$ for GEMs) for the sparse mode, which is used during data taking to maximize the trigger rate.

\begin{figure}[tbh!]
\centering
\includegraphics[width=\textwidth]{\pdirtwo/daq.pdf}
\caption{Scheme for the NA64 DAQ}
\label{fig:daq}
\end{figure}

During the calibration procedure, the three samples received by each channel of the APV25 are also used to set the latency of the trigger. The latency of the trigger is optimal when it covers precisely the rising edge of the pulse received by each channel of the APV25. If we define a$_0$, a$_1$ and a$_2$ as the three samples recorded in consecutive order by a single APV25 pipeline, the latency is to be set such that the second sample a$_1$ is larger than the other two amplitudes. This can be best summarized in the so-called "banana plot" of Fig.\ref{fig:banana-plots}, which is a heat map plotting the frequency of events with certain pulse structure. The sampling of the pulse shape also provides additional information about the time of arrival of the primary electron. By reconstructing the pulse shape rise time one can improve the time estimate by the usual 25 \nas (limited by the clock frequency of the APV) down to $\sim$15 \nas \cite{Banerjee:2017mdu}. To achieve this, the pulse is described by the following function:

\begin{equation}
\label{eq:apv-pulse}
r(t) = \frac{r_0}{(1 + \exp{\frac{t-t_0}{\tau}})}
\end{equation}

Where the parameters $r_0$, $t_0$ and $\tau$ are fitted using the same data measured at different values of the latency. The time of arrival is then extracted by reversing the function and solving for $t$ as a function of the ratio between pulses (Fig.\ref{fig:apv-signal-shape}):

\begin{equation}
\label{eq:2}
t(r) = t_0 + \tau \times \ln{\frac{r_0}{r} - 1}
\end{equation}

A complete description of the method that takes into account the errors of the ratio and the parameters is described in \cite{dbanerjee-thesis}.


\begin{figure}[bth!]
\centering
\caption[apv signal shape]{Shape of the signal of the APV chip and sampling performed.}
\label{fig:apv-signal-shape}
\end{figure}

\begin{figure}[!bth]
\centering
\caption[APV25 banana plot]{Ratio between the first two vs the last two amplitudes sampled in an APV25 chip after the proper latency is set for the chip. The typical "banana" shape of this plot is the sign that the pulse is sampled during its rising edge.}
\label{fig:banana-plot}
\end{figure}

After passing through the ADC, the data is sent to GeSica using a high-speed optical cable. The Gesica can accommodate up to 4 ADC (for a total of 16 APV chips) and has the purpose of multiplexing the incoming data stream, merging the header information from the TCS\footnote{Trigger Control System} with the corresponding data coming from the APV, and finally putting the event data block into the S-link format. Finally, the information are transferred to a high-performance readout buffer PCs (ROB) via the S-link protocol \footnote{The S-link is a protocol developed at CERN for fast point to point connections, typically between front-end electronics and the readout electronics \cite{s-link}.}. In the NA64 case, to accommodate the many GeSica and CATCH modules used, and S-link multiplexer is used to combine multiple modules before sending the data to the ROB. As seen in Fig.\ref{fig:daq}, the Readout buffer PCs receive the information from the multiplexer and stores them in four different spill buffer \footnote{A spill is a 512 MB SDRAM module which can store the data of at least one spill \cite{COMPASS-daq}}. A Gigabit Ethernet\footnote{Gigabit Ethernet is a standard developed by the Institute of Electrical and Electronics Engineers(IEEE) and Local Area Networks (LANs).} switch connects the ROB with the event builders PC. Here the data of every single event and merges them into a single event data block using the event identifier provided by the TCS receiver. After this process, the event is ready to be recorded to the long term storage, in this case of 5 TB SATA Hard Disk with a speed of 40 MB/s. Thanks to this design the DAQ takes advantage of the beam structure of the H4, characterized by a high intensity for 4.8 \si{\second} where the spill buffers are filled by the information coming from the readout modules followed by a long recovery time of $\sim$20 \si{\second} that are used for the event building and to write all the information to the tape.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../PhDthesis"
%%% End:
